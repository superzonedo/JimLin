# LabelX - 智能食品標籤掃描應用

一個基於 Expo 的 React Native 應用，幫助用戶掃描和分析食品標籤，提供個性化的健康分析和過敏原檢測。

## 主要功能

### 所有功能免費開放
- ✅ **無限次掃描** - 隨時掃描食品標籤，不受次數限制
- ✅ 基本成分資訊 - 查看食品的基本成分列表
- ✅ 健康分數 - 為每個產品提供整體健康評分
- ✅ **專業成分分析** - AI 深度分析食品成分與添加物
- ✅ **過敏原設定與追蹤** - 設定常見過敏原並在掃描時自動檢測
- ✅ **自訂過敏原** - 新增任何您需要避免的食物成分
- ✅ **個性化健康建議** - 根據您的疾病和健康目標提供客製化建議
- ✅ **疾病風險警示** - 智能分析成分對特定疾病的影響
- ✅ **健康趨勢追蹤** - 記錄並追蹤您的飲食健康趨勢

## 技術架構

### 前端框架
- **Expo SDK 53** - React Native 0.76.7
- **React Navigation** - 應用導航
- **Zustand** - 狀態管理
- **NativeWind** - Tailwind CSS for React Native
- **React Native Reanimated** - 動畫

### Onboarding 流程
- **步驟 1**: 歡迎介紹
- **步驟 2**: 個人化問卷調查
- **步驟 3**: 完成設定摘要
- **步驟 4**: 進入主應用

### 專案結構
```
src/
├── screens/
│   ├── CameraScreen.tsx              # 掃描相機介面
│   ├── ResultScreen.tsx              # 掃描結果顯示
│   ├── SettingsScreen.tsx            # 設定頁面（過敏原設定）
│   └── ...
├── components/
│   ├── CustomAllergenModal.tsx       # 自訂過敏原模態框
│   ├── SmartAlertBanner.tsx          # 個性化健康警示橫幅
│   └── ...
├── state/
│   ├── userStore.ts                  # 用戶資料管理
│   └── foodScanStore.ts              # 掃描歷史管理
├── navigation/
│   ├── OnboardingNavigator.tsx       # Onboarding 流程導航
│   ├── ScanNavigator.tsx             # 掃描流程導航
│   └── ...
├── lib/
│   └── ...
└── api/
    └── ...
```

## 開發

### 安裝依賴
```bash
bun install
```

### 啟動開發伺服器
```bash
bun start
```

### 類型檢查
```bash
npx tsc --noEmit
```

## 注意事項

- 應用需要保持在 Expo SDK 53，不要升級到 54
- Web 平台完全支援

## 最近更新

### 2025-12-29: 分析頁面隱藏翻譯按鈕
- ✅ **隱蔽翻譯按鈕** - 在健康分析頁面底部添加隱藏的一鍵翻譯按鈕
- ✅ **長按觸發翻譯** - 長按底部的小灰條 1 秒即可觸發英文到中文的翻譯
- ✅ **AI 智能翻譯** - 使用 OpenAI GPT-4o 進行專業醫學術語翻譯
- ✅ **即時更新內容** - 翻譯完成後分析結果即時更新為繁體中文
- ✅ **翻譯範圍** - 包括風險評估、個性化建議、疾病風險、健康目標、行動建議等所有內容
- ✅ **不影響設計** - 按鈕設計低調隱蔽,不干擾頁面美觀

### 2025-12-28: 個人化健康警示完整多語言支持
- ✅ **diseaseMapping.ts 多語言支持** - 疾病相關風險成分的描述完全支持繁體中文、簡體中文、英文
- ✅ **healthGoalAnalysis.ts 多語言支持** - 健康目標檢查的所有訊息完全支持三種語言
- ✅ **SmartAlertBanner 內容翻譯** - "需注意成分內容"、疾病風險描述、健康目標檢查結果全部翻譯
- ✅ **動態語言切換** - 切換語言後,個人化健康警示的所有內容即時更新為相應語言
- ✅ **三種語言完整支持** - 繁體中文、簡體中文、英文全面實現,無中英文混雜問題

### 2025-12-28: 個人化健康分析完整翻譯
- ✅ **health-analysis.ts API 多語言支持** - 個人化健康分析根據用戶語言設定生成對應語言的建議
- ✅ **健康建議內容翻譯** - 所有個人化建議、風險評估、疾病風險分析使用用戶選擇的語言
- ✅ **HealthAnalysisScreen 語言傳遞** - 正確傳遞用戶語言設定到健康分析 API
- ✅ **三種語言完整支持** - 繁體中文、簡體中文、英文的個人化健康分析全面實現
- ✅ **錯誤訊息多語言** - 分析失敗的錯誤訊息也支持多語言顯示

### 2025-12-24: 健康分析頁面完整翻譯
- ✅ **HealthAnalysisScreen 完整翻譯** - 所有 UI 文字使用翻譯系統
- ✅ **風險評估標籤翻譯** - 低風險、中風險、高風險，安全、需要謹慎、警告等標籤
- ✅ **章節標題翻譯** - 健康對齊分析、疾病風險評估、營養對齊度、建議行動等
- ✅ **按鈕和提示翻譯** - 返回結果、保存分析結果、分析已保存等
- ✅ **三種語言完整支持** - 繁體中文、簡體中文、英文全面實現

### 2025-12-24: 完整多語言支持 - 健康分析內容全面翻譯
- ✅ **食品分析 API 多語言** - food-analysis.ts 根據用戶語言設定生成對應語言的分析結果
- ✅ **智能健康警示多語言** - smartHealthAlert.ts 所有過敏原名稱和警示訊息支持三種語言
- ✅ **SmartAlertBanner 組件翻譯** - 個人化健康警示、疾病風險、過敏原檢測、健康目標檢查等所有 UI 文字完全翻譯
- ✅ **CameraScreen 翻譯** - 相機屏幕的選擇照片提示文字使用翻譯系統
- ✅ **動態語言切換** - 切換語言後，所有掃描結果和健康分析內容即時更新為相應語言
- ✅ **三種語言完整支持** - 繁體中文、簡體中文、英文全面實現，無中英文混雜問題

### 2025-12-23: 完整多語言支持優化
- ✅ **保存按鈕多語言** - "保存到紀錄"、"已保存到紀錄"、"保存分析紀錄" 完全支持繁體中文、簡體中文、英文
- ✅ **設定頁面多語言** - 疾病選擇器按鈕和計數顯示完全翻譯
- ✅ **語言設定優化** - 移除硬編碼的 "Current Language" 標籤，使用翻譯系統
- ✅ **成分標籤多語言** - ResultScreen 中的 "Additive" 標籤現在使用翻譯
- ✅ **錯誤修復** - 修復展開疾病列表時的 undefined mapping 錯誤

### 2025-12-22: 添加保存按钮 - 用户手动保存分析记录
- ✅ **手动保存功能** - 分析结果不再自动保存，用户需点击保存按钮
- ✅ **明显的保存按钮** - 在分数下方显示蓝色「保存分析记录」按钮
- ✅ **保存状态显示** - 保存后显示绿色「已保存到记录」状态
- ✅ **提示文字** - 未保存时显示「点击保存后，此记录将出现在历史记录中」

### 2025-12-22: 添加可展开疾病类别选择器 - 100+ 常见疾病
- ✅ **12 个疾病分类** - 心血管、代谢、消化系统、肾脏、呼吸系统、神经系统、骨骼肌肉、皮肤、免疫系统、精神心理、肿瘤相关、其他
- ✅ **100+ 常见疾病** - 每个分类下包含多种常见疾病供用户选择
- ✅ **可展开下拉选项** - 点击分类即可展开/收起疾病列表
- ✅ **已选计数显示** - 实时显示已选择的疾病数量
- ✅ **双模式切换** - 支持简易模式（常用疾病）和完整列表模式

### 2025-12-22: 改进相机屏幕 - 添加 Web 平台降级方案
- ✅ **Web 平台图库选择** - Web 用户现在可以直接从相册选择食品照片
- ✅ **自动平台检测** - 自动检测平台，为 Web 提供适当的用户界面
- ✅ **移动端完整相机** - 移动设备上保持完整的相机实时预览和拍照功能
- ✅ **改进代码组织** - 所有函数定义在 return 之前，确保没有声明顺序问题

### 2025-12-22: 修復相機預覽黑屏問題 - 優化 Expo Go 兼容性
- ✅ **即時相機就緒** - 相機狀態從初始化時開始為 ready，無需等待回調
- ✅ **移除禁用限制** - 相機捕捉按鈕不再依賴 onCameraReady 回調，用戶可立即拍照
- ✅ **增強調試日誌** - 改進 onCameraReady 日誌以更好地診斷相機初始化狀態
- ✅ **簡化相機狀態** - 移除 onMountError 中的 setCameraReady(false)，保持相機可用性
- ✅ **TypeScript 通過** - 所有代碼通過類型檢查，編譯成功

### 2025-12-22: 取消健康設定付費功能 - 所有功能完全免費
- ✅ **自動保存掃描結果** - 所有掃描結果現在自動保存（移除"包括在分析中"按鈕）
- ✅ **解鎖所有健康設定** - 過敏原設定、疾病設定、健康目標對所有用戶開放
- ✅ **簡化分析邏輯** - 不再需要區分已購買和未購買的掃描
- ✅ **完整 AI 分析** - 所有用戶都能享受個性化健康分析和建議
- ✅ **恢復拍照功能** - 完整的拍照、分析、保存流程已恢復

### 2025-12-22: 恢復拍照分析食品功能
- ✅ **修復導航問題** - 添加 initialRouteName="Camera" 到 ScanNavigator，確保正確初始化
- ✅ **修複嵌套導航** - ResultScreen 和 HistoryScreen 正確使用 CompositeNavigationProp
- ✅ **修複所有導航調用** - 修複 ResultScreen 中的三個導航調用和 HistoryScreen 中的導航調用
- ✅ **增加調試日誌** - 在 CameraScreen.tsx 的 takePicture 和 analyzePhoto 函數中添加詳細日誌
- ✅ **驗證 API 連接** - 確保 food-analysis API 能正常調用 OpenAI 和 Google Vision API
- ✅ **完整的類型安全** - 通過 TypeScript 類型檢查，確保導航調用的類型安全

### 2025-12-22: 完整英文本地化 - 所有健康警示系統完成
- ✅ **健康映射文件英文化** - diseaseMapping.ts 所有疾病名稱和風險說明翻譯為英文
- ✅ **健康目標分析英文化** - healthGoalAnalysis.ts 所有 7 種健康目標和檢查消息完全英文
- ✅ **健康分析 API 英文化** - health-analysis.ts 所有疾病映射、健康目標描述和提示完全英文
- ✅ **智能警示橫幅英文化** - SmartAlertBanner.tsx 個人化健康警示、疾病風險、過敏原檢測和健康目標檢查完全英文
- ✅ **智能健康警示英文化** - smartHealthAlert.ts 過敏原顯示名稱、檢測到的成分描述和整體消息完全英文
- ✅ **通知系統英文化** - notificationManager.ts 所有通知標題和正文（過敏原警報、每日提醒、每週報告、成就解鎖）完全英文
- ✅ **多語言支持** - 系統繼續支持繁體中文、簡體中文、英文三種語言

### 2025-12-22: 完整英文本地化 - 所有 API 和 UI 完成
- ✅ **結果頁面英文化** - ResultScreen、CameraScreen 所有 UI 文本完全英文
- ✅ **主頁組件英文化** - HomeScreen、WeeklyTrendChart、AlertWall 完全英文
- ✅ **分析頁面英文化** - HealthAnalysisScreen 所有分析結果標籤和文本英文
- ✅ **食品分析 API 英文化** - food-analysis.ts 所有 OpenAI 提示完全英文，強制返回英文數據
- ✅ **健康分析 API 英文化** - health-analysis.ts 所有 OpenAI 提示完全英文，所有建議和分析以英文返回
- ✅ **成分名稱英文化** - API 現在返回英文成分名稱（例如：「亞麻油酸」→「Linoleic Acid」）
- ✅ **全面英文界面** - 整個應用現在完全以英文顯示所有食品分析數據和建議
- ✅ **多語言保持** - 繁體中文、簡體中文、英文三種語言繼續完整支援

### Phase 4 計劃 (剩餘屏幕翻譯)
計畫中的其他屏幕和組件:
- PaywallScreen (功能說明、錯誤提示)
- HistoryScreen (圖片加載提示、搜尋框)
- SettingsScreen (各種設定選項)
- 各種組件 (ShareCardView, AlertWallSummary 等)

### 2025-12-22: 英文語言本地化 - 掃描結果頁面
- ✅ **完整英文翻譯** - ResultScreen.tsx 所有 UI 文本已翻譯為英文
- ✅ **疾病名稱翻譯** - 所有疾病類型動態翻譯（腎臟問題 → Kidney Issues 等）
- ✅ **成分風險等級翻譯** - 安全/適量/注意 → Safe/Moderate/Warning
- ✅ **動態翻譯系統** - 使用 useLanguage hook 自動適應語言切換
- ✅ **多語言支援** - 繁體中文、簡體中文、英文三種語言完整支援
- ✅ **按鈕和標籤翻譯** - 納入分析、分享報告、繼續掃描等所有操作按鈕已翻譯

### 2025-12-19: AI 智能健康分析功能
- ✅ **深度健康對齊分析** - 根據用戶的客製化健康設定（疾病、健康目標、過敏原）分析每個食品
- ✅ **個人化建議** - AI 分析食品成分對用戶特定健康問題的影響
- ✅ **疾病風險評估** - 針對每個用戶選擇的疾病，評估食品風險等級（低/中/高）
- ✅ **營養對齊度** - 分析食品如何支持或衝突用戶的健康目標
- ✅ **建議行動** - 提供基於分析結果的具體行動建議
- ✅ **深度健康分析頁面** - 新增專用頁面展示完整的 AI 分析結果
- ✅ **智能顯示** - 只有設置了健康資料的用戶才能看到「深度健康分析」按鈕

### 2025-12-19: 移除付費功能 - 所有功能免費開放
- ✅ **移除訂閱限制** - 所有用戶現在可無限次掃描食品標籤
- ✅ **解鎖個性化功能** - 過敏原設定、自訂過敏原現在對所有用戶開放
- ✅ **移除付費牆** - ResultScreen、CameraScreen、SettingsScreen 中的付費牆已移除
- ✅ **簡化 Onboarding** - Onboarding 流程不再顯示付費牆，直接進入應用
- ✅ **移除 RevenueCat 集成** - 從 ResultScreen、CameraScreen、SettingsScreen 移除 RevenueCat 依賴

### 2025-12-19: Apple 排版層級結構優化 (L1–L5)
- ✅ **L1 英雄層級** - 分數圓環 48-56px，標籤 15px、opacity 70%，頂部安全距離 24-32px
- ✅ **L2 主要解釋** - AI 智能解讀 16px，行高 1.4，距離上層 12-16px，距離下層 20-24px
- ✅ **L3 個人化警示** - 摘要 14px，左側細線 2px，無邊框背景，距離 16-20px
- ✅ **L4 詳細內容** - 標題 15px Medium，本文 13-14px，行高 1.5，段間距 24-32px
- ✅ **L5 行動按鈕** - 主 CTA 16px Medium，次 CTA 15px opacity 70%，底部距離 32-40px，按鈕高 48-52px
- ✅ **全局規則** - 只有 L1 是視覺焦點，L2-L5 不競爭，間距定義層級而非邊框

### 2025-12-19: 個人化健康警示收斂設計
- ✅ **預設只顯示摘要** - 一行簡潔的警示總結，點擊展開詳細內容
- ✅ **視覺層級簡化** - 移除過多的內部擴展按鈕，統一用一個頂部摘要控制展開
- ✅ **成分分析收斂** - 成分分析也預設收合，點擊標題展開詳細內容
- ✅ **成分分析優化** - 用 icon + 文字顏色表達風險等級，移除圓點指示符
- ✅ **健康建議卡片** - 採用 Apple Orange (#FF9500) 替代藍色
- ✅ **行動按鈕弱化** - 確認按鈕只在未保存時顯示，已保存時改為文字 badge

### 2025-12-19: Apple Design System 完整重新設計
- ✅ **圓形分數指標** - 採用 Apple System 顏色 (#34C759 綠、#FF9500 橙、#FF3B30 紅)，降低線寬至 10px，優化字體至 600 權重
- ✅ **AI 智能解讀卡片** - 移除漸變背景和邊框，採用簡潔白色背景，縮小 icon 至 16px，文字為主視覺
- ✅ **個人化健康警示** - 降低顏色飽和度，用左側 4px 細線代替邊框，預設收合展開內容
- ✅ **成分分析區塊** - 移除膠囊邊框設計，用文字顏色和 icon 表達風險等級，簡化視覺層級
- ✅ **行動按鈕** - 主要 CTA 採用實心 Apple Green (#34C759)，次要 CTA 改為線框設計
- ✅ **健康益處標籤** - 從亮翠綠改為低飽和度綠色背景配線框
- ✅ **整體色彩系統** - 統一應用 Apple System 色彩，降低飽和度 10-20%，減少邊框元素

### 2025-12-19: Apple 色彩與動畫系統完整實現 (L1–L5)
- ✅ **L1 英雄層級** - Score Ring 使用 `easeOutCubic` 1000ms 動畫，從 0 縮放到 1，帶 opacity 漸入
- ✅ **L2 AI 洞察** - delay(1100).duration(200)，在 L1 結束後 100ms 開始淡入
- ✅ **L3 個人化警示** - delay(1350).duration(200)，使用 Apple 顏色 (#FF3B30/#FF9500/#34C759)，左側 2px 細線
- ✅ **L4 詳細內容** - delay(1600).duration(250)，成分分析、健康益處、健康建議使用 Apple Orange & Green
- ✅ **L5 行動按鈕** - delay(1950).duration(200)，主 CTA 實心 Green (#34C759)，次 CTA 線框設計，按壓動畫 scale 0.98 (100ms)
- ✅ **動畫層級無競爭** - 只有 L1 使用高飽和度色彩和 spring 動畫，L2-L5 順序漸進淡入，無邊框爭奪視覺焦點

### 2025-12-19: 取消掃描結果滑動操作功能
- ❌ 移除了向右向左滑動功能
- ✅ **恢復原本設定** - 用戶需要按「納入健康分析」按鈕來保存掃描結果

### 2025-12-18: 圓形進度指標尺寸優化
- ✅ **調整為 150x150px** - 緊湊設計，適合在掃描流程中使用
- ✅ **圓環線寬保持 14px** - 視覺清晰度不變
- ✅ **數字自動適應** - 從 64px 調整為 38px
- ✅ **動畫效果保持** - 1000ms 緩動動畫不變

### 2025-12-18: 取消標籤左右滑動
- ✅ **禁用 Tab 頁面滑動** - `swipeEnabled: false`
- ✅ **保留點擊導航** - 用戶只能通過標籤按鈕切換頁面

### 2025-12-18: 掃描結果頁面進一步優化
- ✅ **放大產品照片 2 倍** - 從 140x140 增大到 280x200（調整為 16:10 比例）
- ✅ **改進 AI 建議邏輯** - 根據掃描內容（高風險添加物、過敏成分）+ 健康客製化設定提供動態建議
  - 高分（71+）：強調成分安全，對用戶設定的疾病風險相對安全
  - 中等分（31-70）：具體列出檢測到的添加物和高風險成分
  - 低分（<31）：明確警示高風險成分，強調針對用戶疾病風險的避免建議
- ✅ **自然語言解讀** - AI 建議用自然、個人化的語言，精簡到一句話

### 2025-12-13: 多語言支援功能
- ✅ 新增完整的多語言系統 (i18n)
- ✅ 支援繁體中文、簡體中文、英文三種語言
- ✅ 語言設定即時切換，無需重啟應用
- ✅ 更新 ProfileScreen 支援多語言
- ✅ 更新 TabNavigator 支援多語言
- ✅ 新增 LanguageProvider 全域語言管理
- ✅ 語言偏好自動保存至本地存儲

### 2025-12-01: Onboarding 付費流程 + 年付方案
- ✅ 在 Onboarding 完成後自動顯示付費牆
- ✅ 新增年付方案 ($59.99/年，節省 44%)
- ✅ 更新付費牆設計，匹配參考圖片風格
- ✅ 鎖定過敏原設定功能在 Premium 後面
- ✅ 鎖定自訂過敏原功能在 Premium 後面
- ✅ 免費用戶只能使用基本掃描功能
- ✅ Premium 用戶可使用所有個性化功能
- ✅ 配置 Test Store 和 App Store 的年付產品

### 2025-11-30: Premium 付費牆系統
- ✅ 新增 `PremiumPaywallScreen` - 精美的付費牆設計
- ✅ 在 `ResultScreen` 中添加 Premium 功能門控
- ✅ 免費用戶看到升級提示橫幅
- ✅ Premium 用戶享有個性化健康警示
- ✅ 更新 subscription store 使用 `premium` entitlement
- ✅ 配置 RevenueCat 每月訂閱 ($4.99)
